---
title: ""
format:
  html:
    toc: false
    echo: false
    css: search-style.css
    keep-hidden: true
    code-tools: false
    body-classes: search
---

```{ojs}
course_data = FileAttachment("courses.csv").csv({typed: true})

access_modes = ["auditory", "tactile", "textual", "visual"]
default_access_modes = []
audiences = ["Bioinformatician", "Clinician", "Engineer", "Industry", "Open Research Specialist", "Postgraduate taught student", "Postgraduate research student", "Public sector", "Researcher", "Research Software Engineer", "Research skills educator", "Trainer", "Undergraduate student", null]
default_audience = null
educational_levels = ["level1", "level2", "level3", "level4", "level5"]
default_educational_level = []
resource_types = ["course", "onlineCourse", "onlineWorkshop", "workshop", null]
default_resource_type = null
```

```{ojs}
search_query = (search_terms ?? "").toLowerCase().trim()
```

```{ojs}
//| panel: input
viewof search_terms = Inputs.text({placeholder: "Type to search..."})
```


<details>
<summary>Advanced search&hellip;</summary>

```{ojs}
viewof selected_access_mode = Inputs.checkbox(access_modes, {label: "Access mode", value: default_access_modes})
viewof selected_audience = Inputs.select(audiences, {label: "Audience", value: default_audience})
viewof selected_educational_level = Inputs.checkbox(educational_levels, {label: "Level", value: default_educational_level})
viewof selected_resource_type = Inputs.select(resource_types, {label: "Type", value: default_resource_type})
```
</details>

```{ojs}
course_filtered =
  (
    (!selected_audience) &&
    (selected_access_mode ?? []).length === 0 &&
    (selected_educational_level ?? []).length === 0 &&
    (selected_resource_type ?? []).length === 0 &&
    (!search_query)
  )
  ? course_data.filter(row => row.featured === "yes")
  : course_data.filter(row =>
      // audience
      (!selected_audience || row.audience.includes(selected_audience)) &&

      // access mode
      ((selected_access_mode ?? []).length === 0 ||
        (selected_access_mode ?? []).includes(row.accessMode)) &&

      // educational level
      ((selected_educational_level ?? []).length === 0 ||
        (selected_educational_level ?? []).includes(row.educationalLevel)) &&

      // resource type
      ((selected_resource_type ?? []).length === 0 ||
        (selected_resource_type ?? []).includes(row.learningResourceType)) &&

      // search
      (!search_query ||
        row.headline.toLowerCase().includes(search_query))
    )
```

```{ojs}
html`${
  course_filtered.length === 0
  ? html`
    <div class="course-data-empty">
      <p>No results</p>
    </div>
  `
  : course_filtered.map(row => 
  html`
    <div class="${row.featured === "yes" ? "course-data featured" : "course-data"}">
      <h3>
          <a href=${row.url}>${row.headline}</a>
      </h3>
      <p>${row.description}</p>
    </div>
  `
  )
}`
```
