---
title: "CSV Search Tool"
format:
  html:
    toc: false
    echo: false
    keep-hidden: true
    code-tools: false
---

```{ojs}
course_data = FileAttachment("courses.csv").csv({typed: true})

access_modes = ["auditory", "tactile", "textual", "visual"]
default_access_modes = []
audiences = ["Bioinformatician", "Clinician", "Engineer", "Industry", "Open Research Specialist", "Postgraduate taught student", "Postgraduate research student", "Public sector", "Researcher", "Research Software Engineer", "Research skills educator", "Trainer", "Undergraduate student", null]
default_audience = null
educational_levels = ["level1", "level2", "level3", "level4", "level5"]
default_educational_level = []
resource_types = ["course", "onlineCourse", "onlineWorkshop", "workshop", null]
default_resource_type = null
```

```{ojs}
//| panel: input
viewof search_terms = Inputs.text({label: "Search"})
search_query = (search_terms ?? "").toLowerCase().trim()
```

<details>
<summary>Advanced search</summary>

```{ojs}
viewof selected_access_mode = Inputs.checkbox(access_modes, {label: "Access mode", value: default_access_modes})
viewof selected_audience = Inputs.select(audiences, {label: "Audience", value: default_audience})
viewof selected_educational_level = Inputs.checkbox(educational_levels, {label: "Level", value: default_educational_level})
viewof selected_resource_type = Inputs.select(resource_types, {label: "Type", value: default_resource_type})
```
</details>

```{ojs}
course_filtered =
  (
    (!selected_audience) &&
    (selected_access_mode ?? []).length === 0 &&
    (selected_educational_level ?? []).length === 0 &&
    (selected_resource_type ?? []).length === 0 &&
    (!search_query)
  )
  ? course_data.filter(row => row.featured === "yes")
  : course_data.filter(row =>
      // audience
      (!selected_audience || row.audience.includes(selected_audience)) &&

      // access mode
      ((selected_access_mode ?? []).length === 0 ||
        (selected_access_mode ?? []).includes(row.accessMode)) &&

      // educational level
      ((selected_educational_level ?? []).length === 0 ||
        (selected_educational_level ?? []).includes(row.educationalLevel)) &&

      // resource type
      ((selected_resource_type ?? []).length === 0 ||
        (selected_resource_type ?? []).includes(row.learningResourceType)) &&

      // search
      (!search_query ||
        row.headline.toLowerCase().includes(search_query))
    )
```

### Results

```{ojs}
html`${course_filtered.map(row => html`
  <section style="border:1px solid #ddd; border-radius:8px; padding:1em; margin:1em 0;">
    <h3 style="margin-top:0;">
        <a href=${row.url}>${row.headline}</a>
    </h3>
    <p>${row.description}</p>
  </section>
`)}`
```

